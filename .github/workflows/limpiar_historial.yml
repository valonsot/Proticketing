name: Limpiar Ejecuciones Saltadas

on:
  schedule:
    - cron: '0 0 * * *' # Se ejecuta una vez al día
  workflow_dispatch:     # Botón manual para limpiar cuando quieras

jobs:
  delete-skipped:
    runs-on: ubuntu-latest
    permissions:
      actions: write
    steps:
      - name: Borrar solo ejecuciones saltadas (skipped)
        env:
          GH_TOKEN: ${{ github.token }}
          REPO: ${{ github.repository }}
        run: |
          echo "Buscando ejecuciones saltadas por concurrencia..."
          
          # Obtenemos los IDs de las ejecuciones con estado 'skipped'
          ids=$(gh run list --repo $REPO --status skipped --limit 100 --json databaseId --jq '.[].databaseId')
          
          if [ -z "$ids" ]; then
            echo "No hay ejecuciones saltadas para borrar."
          else
            echo "Se han encontrado ejecuciones para eliminar."
            for id in $ids; do
              echo "Borrando ejecución saltada ID: $id"
              gh run delete --repo $REPO $id
            done
            echo "Limpieza finalizada."
          fi
